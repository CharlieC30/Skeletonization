### TEASAR Skeletonization 筆記
---

### 第一階段：核心參數（最先影響結果）
#### 1. scale（控制無效化球體大小）
- 目前：0.3；預設：1.5
- 說明：決定每條路徑追蹤後被「遮蓋」的區域範圍；數值越小，骨架分支越多、結果越細緻

#### 2. const（最小無效化半徑）
- 目前：50；預設：300
- 說明：無效化球體即使在窄小區域也至少維持 const 的半徑；數值越小，細節保留度越高
---

### 第二階段：其他 TEASAR 追蹤參數
#### 3. pdrf_scale（中心線權重）
- 目前：100000；預設：100000
- 說明：越大越偏好走在結構中心，越小越注重最短路徑

#### 4. pdrf_exponent（中心線懲罰強度）
- 目前：4；預設：16（常用 4）
- 說明：搭配 pdrf_scale 的指數項；2/4/8/16 都是常見選擇

#### 5-8. soma 相關參數（細胞體偵測）
- 現況：`soma_detection_threshold` 與 `soma_acceptance_threshold` 均為 999999，等同停用；其餘值採預設

#### 9. max_paths（每個物體的路徑上限）
- 目前：null；預設：null
- 說明：null 代表不限制；若單一物體過於複雜導致時間過長，可設 5000 或 10000
---

### 第三階段：骨架化執行設定
#### 10. dust_threshold（骨架化前過濾體素）
- 目前：500；預設：1000（體素數量）
- 建議：mask 乾淨時保持 500；雜訊多則拉高至 1000/2000 以節省時間

#### 11. anisotropy（voxel size）
- 目前：[1, 1, 1]；預設：(1, 1, 1)
- 說明：定義 [x, y, z] 軸的物理尺寸比例；若體素非等向須調整，例如 [1, 1, 10]

#### 12. fix_branching（分支點修正）
- 目前：true；預設：True
- 說明：會再跑一次 Dijkstra 讓分支點更準確，代價是變慢；精準拓撲建議維持 true

#### 13. fix_borders（邊界端點修正）
- 目前：true；預設：True
- 說明：確保分塊處理時邊界端點可預測，方便後續拼接

#### 14. progress（顯示進度）
- 目前：true；預設：True
- 說明：輸出進度條，建議保持開啟

#### 15. parallel（多核心並行）
- 目前：1；預設：1
- 說明：1 為單進程；>1 會加速但成倍增加記憶體需求；0 使用全部核心、-1 使用核心數減一
- 注意：某些 kimimaro 版本在 parallel>1 時會遇到 `dbf_mmap` 問題，實測後再調高
---

### 第四階段：後處理與清理
#### 16. postprocess_dust_threshold（骨架化後過濾）
- 目前：1000；預設：1500（物理距離）
- 說明：移除短於門檻的孤立骨架段；可依碎片多寡調整 500-2000

#### 17. postprocess_tick_threshold（修剪小支）
- 目前：0；預設：3000
- 說明：限制主幹上短小分支；若想保留所有分支就維持 0，需要簡化可調為 500/1000/2000/3000

#### 18. keep_largest_component_only（保留最大連通元件）
- 目前：true；自訂參數
- 說明：只保留最大連通骨架，其餘孤立部分全部丟棄；若需分析雜散結構請改為 false
---

### 進階但常被忽略的參數
#### 19. fill_holes（骨架化前填洞）
- 預設：False（目前未設定即採預設）
- 說明：mask 內若有空洞，可先填補避免骨架受到干擾

#### 20. fix_avocados（細胞核與細胞體拆分時使用）
- 預設：False
- 說明：針對酪梨狀 segmentation（核、體分開）設計；僅在神經元資料需要

#### 21. parallel_chunk_size（並行回報頻率）
- 預設：100
- 說明：parallel>1 時用來控制進度回報批次；大多情況不需調整

#### 22. in_place（覆寫輸入以省記憶體）
- 預設：False
- 說明：true 會修改原始 mask 換取記憶體節省，除非資源吃緊不要開啟

#### 23-25. 其他高級選項
- `object_ids`：僅處理由特定 ID 組成的物件（通常在程式碼層級指定）
- `extra_targets_before/after`：強制追蹤特定座標，屬於客製化用途
- `voxel_graph`：自訂體素連接方式，多用於研究性質需求
- 建議：若沒有客製需求全部保持預設即可
